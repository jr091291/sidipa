function createSimulacion(){var e=null,n=Canvas(document.getElementById("myCanvas"),window.innerWidth,window.innerHeight-80),i=Onda(100,1,0);return e=Graph(n,i),e.setParam(0,n.getCanvas().height/2,1,1,2,"red"),e}var Canvas=function(e,n,i){var t,o,a=function(e,n,i,t,a){o.fillStyle=a,o.fillRect(e,n,i,t)},r=function(e,n,i,t,a,r){o.beginPath(),o.moveTo(e,n),o.lineTo(i,t),o.strokeStyle=r,o.lineWidth=a,o.stroke()},c=function(e,n,i,t,a){o.beginPath(),o.arc(e,n,i,t,2*Math.PI),o.lineTo(xf,yf),o.strokeStyle=a,o.lineWidth=t,o.closePath(),o.stroke()},u=function(e,n,i,t){o.clearRect(e,n,i,t)},l=function(e,n,i,t,a,r){e=n.toString()+"px "+e,o.fillStyle=r,o.font=e,o.fillText(i,t,a+n)},s=function(e,n,i){return"CANVAS"==e.tagName&&e.ELEMENT_NODE?(t=e,o=e.getContext("2d"),t.width=n,t.height=i,{rectangulo:a,line:r,circle:c,clear:u,text:l,setCanvas:s,getCanvas:function(){return t},getContext:function(){return o}}):null};return s(e,n,i)},Graph=function(e,n){function i(){$("#ctr_amplitud").val(n.getAmplitud()),$("#ctr_frecuencia").val(n.getFrecuencia()),$("#ctr_periodos").val(o.num_periodos),$("#ctr_velocidad").val(o.velocidad),$("#ctr_amplitud_label").html("Amplitud Maxima: "+n.getAmplitud()),$("#ctr_frecuencia_label").html("Frecuencia de Onda: "+n.getFrecuencia()),$("#ctr_velocidad_label").html("Velocidad Renderizado: "+o.velocidad),$("#ctr_periodos_label").html("Periodos Por Pantalla: "+o.num_periodos);var e=n.getDesface(),i=$("input[name=fase]");for(index in i)i[index].value==e&&(i[index].checked=!0)}var t=n,o={init:{xi:0,yi:0},i:0,xi:0,yi:0,velocidad:1,num_periodos:1,grosor_linea:2,color_linea:"red"},a=!1,r=!1,c=function(){var n=e.getCanvas();e.rectangulo(0,0,n.width,n.height,"white"),e.line(0,n.height/2,n.width,n.height/2,2,"green"),e.text("Georgia",20,0,0,n.height/2,"red"),u(n),l(n)};_getPosicion=function(e){return 0==e?"0":e%2==0&&e/2==1?"π":e%2!=0&&1==e?"π/2":e%2!=0&&e/2!=1?e.toString()+"π/2":e%2==0&&e/2!=1?(e/2).toString()+"π":void 0};var u=function(i){for(var t=i.height/2,a=i.height/2,r=0;r<i.width;r++){var c=n.getFuntionForWindows(i.height/2,r,i.width,o.num_periodos).y;c>t&&(t=c),a>c&&(a=c)}aux=n.getAmplitud(),e.line(0,t,i.width,t,2,"green"),e.text("Georgia",20,-aux,0,t,"red"),e.line(0,a,i.width,a,2,"green"),e.text("Georgia",20,aux,0,a,"red")},l=function(n){for(var i=Math.round(n.width/(4*o.num_periodos)),t=4*o.num_periodos,a=0,r=0;t>=r;r++){var c=_getPosicion(r);e.line(a,0,a,n.height,2,"green"),e.text("Georgia",20,c,a-20,n.height/2,"red"),a+=i}};c();var s=function(){var i=e.getCanvas();if(o.i<i.width){for(var t=0;t<2001-o.velocidad;t++){var a=o.i,u=n.getFuntionForWindows(i.height/2,a,i.width,o.num_periodos).y;e.line(o.xi,o.yi,a,u,o.grosor_linea,o.color_linea),o.xi=a,o.yi=u}o.i++}else o.xi=o.init.xi,o.yi=o.init.yi,o.i=0,e.clear(0,0,i.width,i.height,"white"),c(),r?r(!0):null},d=function(e){o.init.xi=parseInt(e),o.xi=parseInt(e)},m=function(e){o.init.yi=parseInt(e),o.yi=parseInt(e)},f=function(e){o.velocidad=parseInt(e)},g=function(e){o.num_periodos=parseInt(e)},p=function(e){o.grosor_linea=parseInt(e)},h=function(e){o.color_linea=e.toString()},v=function(e,n,i,t,o,a){d(e),m(n),f(i),g(t),p(o),h(a)},_=function(){a=setInterval(function(){s()},1)},x=function(){a?clearInterval(a):null},I=function(){e.getCanvas();return{onda:{amplitud:n.getAmplitud(),frecuencia:n.getFrecuencia(),fase:n.getDesface()},param:{velocidad:o.velocidad,num_periodos:o.num_periodos,grosor_linea:o.grosor_linea,color_linea:o.color_linea}}},y=function(e){n.setAmplitud(e.onda.amplitud),n.setFrecuencia(e.onda.frecuencia),n.setDesface(e.onda.fase),o.velocidad=e.param.velocidad,o.num_periodos=e.param.num_periodos,o.grosor_linea=e.param.grosor_linea,o.color_linea=e.param.color_linea,i()};return{setParam:v,setXi:d,setYi:m,setVelocidad:f,setNumPeriodos:g,setGrosor:p,setColor:h,Ionda:function(){return t},getParam:function(){return o},run:function(){_()},stop:function(){x()},clean:function(){c()},reset:function(){o.i=0},getContext:function(){return I()},setContext:function(e){y(e)},onfinish:function(e){return("function"==typeof e||e===!1)&&(r=e),r}}},Onda=function(e,n,i){var t,o,a,r=function(e){"number"==typeof e?t=e:console.error("Tipo de Dato Invalido : Ingrese un Numero")},c=function(e){"number"==typeof e?o=e:console.error("Tipo de Dato Invalido : Ingrese un Numero")},u=function(e){"number"==typeof e?a=e*Math.PI/180:console.error("Tipo de Dato Invalido : Ingrese un Numero")},l=function(e){return"number"==typeof e?o=e/2*Math.PI:console.error("Tipo de Dato Invalido : Ingrese un Numero"),0},s=function(e){"number"==typeof e?o=1/e:console.error("Tipo de Dato Invalido : Ingrese un Numero")},d=function(){return t},m=function(){return o},f=function(){return 180*a/Math.PI},g=function(){return 2*Math.PI*o},p=function(){return 1/o},h=function(e,n,i,o){var e=e-t*Math.sin(g()*n/(i/o)+a);return{x:n,y:e}},v=function(e){var n=g(),i=t*Math.trunc(Math.sin(n*e/n+a));return{x:e,y:i}},_=function(e,n,i){return"number"==typeof e&&"number"==typeof n&&"number"==typeof i?(r(e),c(n),u(i),{setAmplitud:r,setFrecuencia:c,setDesface:u,setAngularFrecuencia:l,setPeriodo:s,getAmplitud:d,getFrecuencia:m,getDesface:f,getAngularFrecuencia:g,getPeriodo:p,getFuntionForWindows:h,getFuntionForTime:v,set:_}):(console.error("Se Han Ingresado Parametros Incorrectos"),null)};return _(e,n,i)},simulacion;$(document).ready(function(){setInterval(function(){amplitud=parseFloat($("#ctr_amplitud").val()),frecuencia=parseFloat($("#ctr_frecuencia").val()),fase=parseFloat($("input[name=fase]:checked").val()),periodos=parseFloat($("#ctr_periodos").val()),velocidad=parseFloat($("#ctr_velocidad").val()),simulacion?(simulacion.Ionda().set(amplitud,frecuencia,fase),simulacion.setVelocidad(velocidad),simulacion.setNumPeriodos(periodos)):simulacion=createSimulacion(),$("#info_amplitud").html((simulacion.Ionda().getAmplitud()/parseFloat($("#ctr_amplitud")[0].max)*100).toFixed(2)+"%"),$("#info_frecuencia").html((simulacion.Ionda().getFrecuencia()/parseFloat($("#ctr_frecuencia")[0].max)*100).toFixed(2)+"%"),$("#info_fase").html((simulacion.Ionda().getDesface()/360*100).toFixed(2)+"%"),$("#inf_freAng").html(simulacion.Ionda().getAngularFrecuencia().toFixed(2)),$("#info_periodo").html(simulacion.Ionda().getPeriodo().toFixed(4)),$("#porc_amp")[0].style.width=$("#info_amplitud").html(),$("#porc_fre")[0].style.width=$("#info_frecuencia").html(),$("#porc_fase")[0].style.width=$("#info_fase").html()},100)}),$(document).ready(function(){function e(e){(mensaje=$("#mensaje").val())&&(e.emit("send",mensaje),$("#mensaje").val("")),setTimeout(function(){var e=$("#mensajes")[0];e.scrollTop=e.scrollHeight},200)}function n(e){var n="";e.chat instanceof Array?e.chat.forEach(function(e){n+='<div class="msg"><strong>'+e.user+": </strong>"+e.mensaje+"</div>"}):n='<div class="msg"><strong>'+e.user+": </strong>"+e.mensaje+"</div>",$("#mensajes")[0].innerHTML+=n}var i=io.connect();i.emit("conectar",{room:_dataSimulacion.id,user:_dataSimulacion.user,userId:_dataSimulacion.userId}),i.on("recive",function(e){n(e)}),i.on("reciveSimulacion",function(e){e&&(simulacion?null:simulacion=createSimulacion(),simulacion.setContext(e),simulacion.onfinish(function(e){if(e){simulacion.stop();var n=simulacion.getContext();i.emit("finish",n),console.log("Se Ha Finalizado La Simulacion: "+Date.now())}}),simulacion.run(),console.log("Se Ha Iniciado La Simulacion: "+Date.now()))}),i.on("noSimulation",function(){simulacion?null:simulacion=createSimulacion(),simulacion.stop(),simulacion.clean(),simulacion.reset()}),$("#sendMensagge").on("click",function(){e(i)}),$("#mensaje")[0].onkeypress=function(n){"Enter"===n.code&&e(i)}});